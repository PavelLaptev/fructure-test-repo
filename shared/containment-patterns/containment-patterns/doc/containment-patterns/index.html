<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Containment Patterns: Capture contexts in s-expressions</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="file:///usr/share/doc/racket/local-redirect/local-redirect.js"></script><script type="text/javascript" src="file:///home/disconcision/.racket/7.3/doc/local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Containment Patterns:<span class="mywbr"> &nbsp;</span> Capture contexts in s-<wbr></wbr>expressions</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._examples%29" class="tocviewlink" data-pltdoc="x">An example</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._patterns%29" class="tocviewlink" data-pltdoc="x">Pattern Forms</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._why%29" class="tocviewlink" data-pltdoc="x">Why</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._advanced%29" class="tocviewlink" data-pltdoc="x">Advanced use:<span class="mywbr"> &nbsp;</span> Traverse arbitrary structures</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">Containment Patterns:<span class="mywbr"> &nbsp;</span> Capture contexts in s-<wbr></wbr>expressions</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._examples%29" class="tocsubseclink" data-pltdoc="x">An example</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._nightmare%29" class="tocsubseclink" data-pltdoc="x">Tangerine Nightmare</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._examples%29" class="tocsubseclink" data-pltdoc="x">More examples</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._patterns%29" class="tocsubseclink" data-pltdoc="x">Pattern Forms</a></td></tr><tr><td><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">&#8945;</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b11%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">&#8945;1</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">&#8945;+</span></span></a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._why%29" class="tocsubseclink" data-pltdoc="x">Why</a></td></tr><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._how%29" class="tocsubseclink" data-pltdoc="x">How</a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._gotchas%29" class="tocsubseclink" data-pltdoc="x">Gotchas</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._advanced%29" class="tocsubseclink" data-pltdoc="x">Advanced use:<span class="mywbr"> &nbsp;</span> Traverse arbitrary structures</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.3</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.3&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.3&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.3&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;containment-patterns/containment-patterns.scrbl&quot;)" x-source-pkg="containment-patterns" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(mod-path._containment-patterns)"></a>Containment Patterns: Capture contexts in s-expressions</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Andrew Blinn &lt;<a href="mailto:racket@andrewblinn.com">racket@andrewblinn.com</a>&gt;</p></span></div><p>Containment-patterns implements several match-expanders which can be used anywhere
<span class="RktSym">racket/match</span> pattern-matching is available. &#8945; , &#8945;+ , and &#8945;1 descend
into s-expressions to capture arbitarily deep matches and their multi-holed contexts.</p><p>Insert a &#8945; in Dr. Racket by typing \ddo (diagonal dots) and then pressing alt+\</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._examples%29" class="toptoclink" data-pltdoc="x">1<span class="hspace">&nbsp;</span>An example</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._nightmare%29" class="toclink" data-pltdoc="x">1.1<span class="hspace">&nbsp;</span>Tangerine Nightmare</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._examples%29" class="toclink" data-pltdoc="x">1.2<span class="hspace">&nbsp;</span>More examples</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._patterns%29" class="toptoclink" data-pltdoc="x">2<span class="hspace">&nbsp;</span>Pattern Forms</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._why%29" class="toptoclink" data-pltdoc="x">3<span class="hspace">&nbsp;</span>Why</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._how%29" class="toclink" data-pltdoc="x">3.1<span class="hspace">&nbsp;</span>How</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._gotchas%29" class="toclink" data-pltdoc="x">3.2<span class="hspace">&nbsp;</span>Gotchas</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._advanced%29" class="toptoclink" data-pltdoc="x">4<span class="hspace">&nbsp;</span>Advanced use: Traverse arbitrary structures</a></p></td></tr></table><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left" colspan="2"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.3/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.3" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">containment-patterns</span></a><span class="RktPn">)</span></td></tr><tr><td align="left">&nbsp;</td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/containment-patterns" title="Install this package using `raco pkg install containment-patterns`"><span class="stt">containment-patterns</span></a></span></td></tr></table></p><h3 x-source-module="(lib &quot;containment-patterns/containment-patterns.scrbl&quot;)" x-source-pkg="containment-patterns" x-part-tag="&quot;examples&quot;">1<tt>&nbsp;</tt><a name="(part._examples)"></a>An example</h3><h4 x-source-module="(lib &quot;containment-patterns/containment-patterns.scrbl&quot;)" x-source-pkg="containment-patterns" x-part-tag="&quot;nightmare&quot;">1.1<tt>&nbsp;</tt><a name="(part._nightmare)"></a>Tangerine Nightmare</h4><p>Seamlessly extract a &#127818; from a deeply-nested situation &#128293;.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">situation</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">&#128293;</span><span class="hspace">&nbsp;</span><span class="RktVal">&#128293;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&#128293;</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">&#127814;</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&#128293;</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&#128293;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">&#127818;</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">&#128293;</span><span class="hspace">&nbsp;</span><span class="RktVal">&#128293;</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">&#127824;</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&#128293;</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktSym">situation</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%29%29" class="RktStxLink" data-pltdoc="x">&#8945;</a></span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">target</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">target</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'&#127818;</span></p></td></tr></table></blockquote><h4 x-source-module="(lib &quot;containment-patterns/containment-patterns.scrbl&quot;)" x-source-pkg="containment-patterns" x-part-tag="&quot;examples&quot;">1.2<tt>&nbsp;</tt><a name="(part._examples)"></a>More examples</h4><p><div class="SIntrapara">1. Check if an item is contained in a nested list:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%29%29" class="RktStxLink" data-pltdoc="x">&#8945;</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">2. Extract data from a nested context:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">zap</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%29%29" class="RktStxLink" data-pltdoc="x">&#8945;</a></span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'zap</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">3. Make an update in a nested context:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&#9657;</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%29%29" class="RktStxLink" data-pltdoc="x">&#8945;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">context</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">&#9657;</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%29%29" class="RktStxLink" data-pltdoc="x">&#8945;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">context</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">&#9657;</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'(0 0 (0 (0 0 (&#9657; 2)) 0 0))</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">4. Make multiple substitutions.
                   Note how &#8945;+ is optional in the template; a context is just a function:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxLink" data-pltdoc="x">&#8945;+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'(0 3 (0 4 (5 0)) 0 6)</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">5. Move a cursor &#9657; through a traversal in a nested list of 0s and 1s:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&#9657;</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxLink" data-pltdoc="x">&#8945;+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">&#9657;</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">_</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym">number?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxLink" data-pltdoc="x">&#8945;+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">...</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&#9657;</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">y</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">z</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">w</span><span class="hspace">&nbsp;</span><span class="RktVal">...</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,@</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&#9657;</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">z</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,@</span><span class="RktSym">w</span><span class="RktVal">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'(0 1 (0 1 (1 0)) (&#9657; 0) 1)</span></p></td></tr></table></blockquote></div></p><h3 x-source-module="(lib &quot;containment-patterns/containment-patterns.scrbl&quot;)" x-source-pkg="containment-patterns" x-part-tag="&quot;patterns&quot;">2<tt>&nbsp;</tt><a name="(part._patterns)"></a>Pattern Forms</h3><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._containment-patterns/main..rkt)._~e2~8b~b1))"></a><span title="Provided from: containment-patterns | Package: containment-patterns"><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">&#8945;</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;pattern&gt;</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">&#8945;</a></span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;context-name&gt;</span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;pattern&gt;</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Traverses a target s-expression left-to-right and depth-first
until a match to <span class="RktVar">&lt;pattern&gt;</span> is found, then hands off control to &lt;pattern&gt;.
Optionally, the context surrounding the match is captured as a
unary procedure called &lt;context-name&gt; satisfying
<span class="RktPn">(</span><span class="RktSym">equal?</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">&lt;context&gt;</span><span class="stt"> </span><span class="RktSym">the-match</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">orginal-sexpr</span><span class="RktPn">)</span>.
In a template <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%29%29" class="RktStxLink" data-pltdoc="x">&#8945;</a></span><span class="stt"> </span><span class="RktVar">&lt;context-name&gt;</span><span class="stt"> </span><span class="RktSym">new-content</span><span class="RktPn">)</span> is
just a gloss for <span class="RktPn">(</span><span class="RktVar">&lt;context-name&gt;</span><span class="stt"> </span><span class="RktSym">new-content</span><span class="RktPn">)</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._containment-patterns/main..rkt)._~e2~8b~b11))"></a><span title="Provided from: containment-patterns | Package: containment-patterns"><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b11%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">&#8945;1</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;context-name&gt;</span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;pattern&gt;</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Same as <span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%29%29" class="RktStxLink" data-pltdoc="x">&#8945;</a></span> except it enforces that the match must be unique.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._containment-patterns/main..rkt)._~e2~8b~b1+))"></a><span title="Provided from: containment-patterns | Package: containment-patterns"><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">&#8945;+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;context-name&gt;</span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;pattern&gt;</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">&#8945;+</a></span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;context-name&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">until</span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;stop-pattern&gt;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;pattern&gt;</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">&#8945;+</a></span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;context-name&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">capture-when</span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;pattern&gt;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;results-pattern&gt;</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%29%29" class="RktStxLink" data-pltdoc="x">&#8945;</a></span> except all matches are captured as an n)-element list, and
 <span class="RktVar">&lt;context-name&gt;</span> is bound to an n-ary procedure representing
 an n-holed context.</div></p><p>If the <span class="RktVar">until</span> subform is included, the traversal neither matches nor descent into values
matching the <span class="RktVar">&lt;stop-pattern&gt;</span>.</p><p><div class="SIntrapara">Example: Toy scope-aware subtitution:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">let</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">[</span><span class="RktVal">w</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">]</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">z</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">let</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">[</span><span class="RktVal">z</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktVal">]</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">z</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">let</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">[</span><span class="RktVal">y</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">]</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">z</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxLink" data-pltdoc="x">&#8945;+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">until</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">let</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">[</span><span class="RktVal">z</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">_</span><span class="RktVal">]</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">_</span><span class="hspace">&nbsp;</span><span class="RktVal">...</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">z</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxLink" data-pltdoc="x">&#8945;+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">new-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'(let ((w 1)) new-name (let ((z 2)) z) (let ((y 3)) new-name))</span></p></td></tr></table></blockquote></div></p><p>If the <span class="RktVar">capture-when</span> subform is included, results meeting <span class="RktVar">&lt;pattern&gt;</span>
are captured as a list, which can then be matched against as a whole by
<span class="RktVar">&lt;results-pattern&gt;</span>. Note that this is an experimental feature which may be
changed or removed in future versions.</p><p><div class="SIntrapara">Example: moving a cursor</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&#9657;</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxLink" data-pltdoc="x">&#8945;+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">capture-when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">&#9657;</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">_</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym">number?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">...</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&#9657;</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">y</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">z</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">w</span><span class="hspace">&nbsp;</span><span class="RktVal">...</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxLink" data-pltdoc="x">&#8945;+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,@</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&#9657;</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">z</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,@</span><span class="RktSym">w</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'(0 1 (0 1 (1 0)) (&#9657; 0) 1)</span></p></td></tr></table></blockquote></div></p><p>Contrast this example to example 5 above; this variant is essentially
a gloss for nested matches.</p><h3 x-source-module="(lib &quot;containment-patterns/containment-patterns.scrbl&quot;)" x-source-pkg="containment-patterns" x-part-tag="&quot;why&quot;">3<tt>&nbsp;</tt><a name="(part._why)"></a>Why</h3><p>I implemented containment patterns to write concise updates on
nested structures for syntax-rewriting purposes in structured-editing
and algebraic-stepper prototypes. See <a href="https://github.com/disconcision/fructure">fructure</a>
for an actual use case, or for something simpler,
<a href="https://github.com/disconcision/racketlab/blob/master/choice-stepper.rkt">this toy stepper</a>.</p><h4 x-source-module="(lib &quot;containment-patterns/containment-patterns.scrbl&quot;)" x-source-pkg="containment-patterns" x-part-tag="&quot;how&quot;">3.1<tt>&nbsp;</tt><a name="(part._how)"></a>How</h4><p>An &rsquo;n-holed context&rsquo; is a captured composable continuation which
can be called in a pattern template as a normal n-ary procedure. These continuations
are captured as the pattern-matcher left-to-right preorder-traverses the target
looking for matches.</p><h4 x-source-module="(lib &quot;containment-patterns/containment-patterns.scrbl&quot;)" x-source-pkg="containment-patterns" x-part-tag="&quot;gotchas&quot;">3.2<tt>&nbsp;</tt><a name="(part._gotchas)"></a>Gotchas</h4><p>Caveat: If you&rsquo;re using any matchers which have side-effects,
note that the inner pattern is evaluated twice for each successful match.</p><h3 x-source-module="(lib &quot;containment-patterns/containment-patterns.scrbl&quot;)" x-source-pkg="containment-patterns" x-part-tag="&quot;advanced&quot;">4<tt>&nbsp;</tt><a name="(part._advanced)"></a>Advanced use: Traverse arbitrary structures</h3><p><div class="SIntrapara">Example: Toy scope-aware subtitution:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">let</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">[</span><span class="RktVal">w</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">]</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">z</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">let</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">[</span><span class="RktVal">z</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktVal">]</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">z</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">let</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">[</span><span class="RktVal">y</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">]</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">z</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxLink" data-pltdoc="x">&#8945;+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">until</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">let</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">[</span><span class="RktVal">z</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">_</span><span class="RktVal">]</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">_</span><span class="hspace">&nbsp;</span><span class="RktVal">...</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">z</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._containment-patterns%2Fmain..rkt%29._~e2~8b~b1%2B%29%29" class="RktStxLink" data-pltdoc="x">&#8945;+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">new-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'(let ((w 1)) new-name (let ((z 2)) z) (let ((y 3)) new-name))</span></p></td></tr></table></blockquote></div></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.3&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.3&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.3&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>